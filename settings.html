<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨­å®š</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>A10ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</h1>
        <div class="user-name" id="userNameDisplay"></div>
    </header>
    
    <main>
        <div class="settings-container">
            <h1>è¨­å®š</h1>

            <form id="settingsForm" class="settings-form">
                <div class="settings-section">
                    <div class="settings-section-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ </div>
                    <label for="displayName">è¡¨ç¤ºå</label>
                    <input type="text" id="displayName" placeholder="è¡¨ç¤ºã—ãŸã„åå‰ã‚’å…¥åŠ›">
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">æ€§åˆ¥</div>
                    <div class="gender-options">
                        <label><input type="radio" name="gender" value="male"> ç”·æ€§</label>
                        <label><input type="radio" name="gender" value="female"> å¥³æ€§</label>
                        <label><input type="radio" name="gender" value="other"> ãã®ä»–</label>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">ç”Ÿå¹´æœˆæ—¥</div>
                    <label for="birthdate">ç”Ÿå¹´æœˆæ—¥</label>
                    <input type="date" id="birthdate">
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">å­¦éƒ¨</div>
                    <label for="department">å­¦éƒ¨</label>
                    <select id="department" class="settings-form">
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="æ³•å­¦éƒ¨">æ³•å­¦éƒ¨</option>
                        <option value="çµŒæ¸ˆå­¦éƒ¨">çµŒæ¸ˆå­¦éƒ¨</option>
                        <option value="çµŒå–¶å­¦éƒ¨">çµŒå–¶å­¦éƒ¨</option>
                        <option value="ç†å·¥å­¦éƒ¨">ç†å·¥å­¦éƒ¨</option>
                        <option value="æƒ…å ±å·¥å­¦éƒ¨">æƒ…å ±å·¥å­¦éƒ¨</option>
                        <option value="ã²ã¿ã¤">ã²ã¿ã¤</option>
                    </select>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">è‡ªå·±ç´¹ä»‹</div>
                    <label for="selfIntroduction">è‡ªå·±ç´¹ä»‹ï¼ˆ100æ–‡å­—ç¨‹åº¦ï¼‰</label>
                    <textarea id="selfIntroduction" class="settings-form" rows="4" maxlength="100" placeholder="è‡ªå·±ç´¹ä»‹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ100æ–‡å­—ã¾ã§ï¼‰"></textarea>
                    <p class="settings-note">â€» 100æ–‡å­—ã¾ã§å…¥åŠ›å¯èƒ½ã§ã™ã€‚</p>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">è¶£å‘³</div>
                    <div class="choice-buttons" id="hobbyButtons">
                        <button type="button" class="choice-button" data-hobby="sports">ã‚¹ãƒãƒ¼ãƒ„</button>
                        <button type="button" class="choice-button" data-hobby="games">ã‚²ãƒ¼ãƒ </button>
                        <button type="button" class="choice-button" data-hobby="music">éŸ³æ¥½</button>
                        <button type="button" class="choice-button" data-hobby="reading">èª­æ›¸</button>
                        <button type="button" class="choice-button" data-hobby="travel">æ—…è¡Œ</button>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-section-title">ã‚¢ã‚¤ã‚³ãƒ³</div>
                    <div class="choice-buttons" id="iconButtons">
                        <button type="button" class="icon-choice-button" data-icon="â—">â—</button>
                        <button type="button" class="icon-choice-button" data-icon="â– ">â– </button>
                        <button type="button" class="icon-choice-button" data-icon="â–²">â–²</button>
                        <button type="button" class="icon-choice-button" data-icon="â—†">â—†</button>
                        <button type="button" class="icon-choice-button" data-icon="â˜…">â˜…</button>
                    </div>
                    <p class="settings-note">â€» é¸æŠã—ãŸã‚¢ã‚¤ã‚³ãƒ³ã¯ã€ãƒ˜ãƒƒãƒ€ãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ã®æ¨ªã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
                </div>

                <button type="submit" class="settings-save-button">ä¿å­˜</button>
            </form>
        </div>
    </main>
    
    <footer>
        <a href="button1.html" class="footer-btn">ãƒœã‚¿ãƒ³1</a>
        <a href="button2.html" class="footer-btn">ãƒœã‚¿ãƒ³2</a>
        <a href="team.html" class="footer-btn team-btn">ğŸ‘¥</a>
        <a href="settings.html" class="footer-btn settings-btn">âš™ï¸</a>
    </footer>
    
    <script>
        function getUserProfile() {
            const storedUsername = localStorage.getItem('username') || '';
            const raw = localStorage.getItem('userProfile');
            let profile = {
                username: storedUsername,
                gender: '',
                birthdate: '',
                department: '',
                selfIntroduction: '',
                hobbies: [],
                icon: ''
            };
            if (raw) {
                try {
                    const parsed = JSON.parse(raw);
                    profile = { ...profile, ...parsed };
                } catch (e) {
                    // ignore parse error
                }
            }
            if (!profile.username && storedUsername) {
                profile.username = storedUsername;
            }
            return profile;
        }

        function getAllUsers() {
            const raw = localStorage.getItem('allUsers');
            if (!raw) return [];
            try {
                return JSON.parse(raw);
            } catch (e) {
                return [];
            }
        }

        function saveAllUsers(users) {
            localStorage.setItem('allUsers', JSON.stringify(users));
        }

        function addOrUpdateUserInList(profile) {
            if (!profile.username) return;
            const allUsers = getAllUsers();
            const existingIndex = allUsers.findIndex(u => u.username === profile.username);
            if (existingIndex >= 0) {
                allUsers[existingIndex] = { ...allUsers[existingIndex], ...profile };
            } else {
                allUsers.push({ ...profile });
            }
            saveAllUsers(allUsers);
        }

        function saveUserProfile(profile) {
            localStorage.setItem('userProfile', JSON.stringify(profile));
            if (profile.username) {
                localStorage.setItem('username', profile.username);
                addOrUpdateUserInList(profile);
            }
        }

        function applyHeaderProfile() {
            const el = document.getElementById('userNameDisplay');
            if (!el) return;

            const profile = getUserProfile();
            if (!profile.username) {
                el.textContent = '';
                return;
            }

            const iconHtml = profile.icon
                ? `<span class="user-icon">${profile.icon}</span>`
                : '';

            el.innerHTML =
                `<span class="user-name-content">` +
                iconHtml +
                `<span class="user-name-text">${profile.username}</span>` +
                `</span>`;
        }

        // è¨­å®šãƒ•ã‚©ãƒ¼ãƒ ã®åˆ¶å¾¡
        const settingsForm = document.getElementById('settingsForm');
        const displayNameInput = document.getElementById('displayName');
        const birthdateInput = document.getElementById('birthdate');
        const departmentSelect = document.getElementById('department');
        const selfIntroductionTextarea = document.getElementById('selfIntroduction');
        const hobbyButtons = document.querySelectorAll('#hobbyButtons .choice-button');
        const iconButtons = document.querySelectorAll('#iconButtons .icon-choice-button');

        function loadFormFromProfile() {
            const profile = getUserProfile();

            displayNameInput.value = profile.username || '';
            if (profile.birthdate) {
                birthdateInput.value = profile.birthdate;
            }
            if (profile.department) {
                departmentSelect.value = profile.department;
            }
            if (profile.selfIntroduction) {
                selfIntroductionTextarea.value = profile.selfIntroduction;
            }

            if (profile.gender) {
                const genderRadio = document.querySelector(`input[name="gender"][value="${profile.gender}"]`);
                if (genderRadio) {
                    genderRadio.checked = true;
                }
            }

            if (Array.isArray(profile.hobbies)) {
                hobbyButtons.forEach((btn) => {
                    const hobby = btn.getAttribute('data-hobby');
                    if (profile.hobbies.includes(hobby)) {
                        btn.classList.add('selected');
                    } else {
                        btn.classList.remove('selected');
                    }
                });
            }

            if (profile.icon) {
                iconButtons.forEach((btn) => {
                    if (btn.getAttribute('data-icon') === profile.icon) {
                        btn.classList.add('selected');
                    } else {
                        btn.classList.remove('selected');
                    }
                });
            }
        }

        hobbyButtons.forEach((btn) => {
            btn.addEventListener('click', () => {
                btn.classList.toggle('selected');
            });
        });

        iconButtons.forEach((btn) => {
            btn.addEventListener('click', () => {
                iconButtons.forEach((b) => b.classList.remove('selected'));
                btn.classList.add('selected');
            });
        });

        settingsForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const profile = getUserProfile();

            const username = displayNameInput.value.trim();
            if (username) {
                profile.username = username;
            }

            const genderRadio = document.querySelector('input[name="gender"]:checked');
            profile.gender = genderRadio ? genderRadio.value : '';

            profile.birthdate = birthdateInput.value || '';
            profile.department = departmentSelect.value || '';
            profile.selfIntroduction = selfIntroductionTextarea.value.trim() || '';

            const selectedHobbies = [];
            hobbyButtons.forEach((btn) => {
                if (btn.classList.contains('selected')) {
                    selectedHobbies.push(btn.getAttribute('data-hobby'));
                }
            });
            profile.hobbies = selectedHobbies;

            let selectedIcon = '';
            iconButtons.forEach((btn) => {
                if (btn.classList.contains('selected')) {
                    selectedIcon = btn.getAttribute('data-icon');
                }
            });
            profile.icon = selectedIcon;

            saveUserProfile(profile);
            applyHeaderProfile();
            alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸã€‚');
        });

        // åˆæœŸè¡¨ç¤º
        loadFormFromProfile();
        applyHeaderProfile();
    </script>
</body>
</html>

